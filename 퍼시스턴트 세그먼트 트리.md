# 00_퍼시스턴트 세그먼트 트리(Persistent Segment Tree)

> 퍼시스턴트 세그먼트 트리(Persistent Segment Tree)

어떤 자료 구조가 `persistent`하다는 것은 `상태의 변화가 생기더라도 과거의 상태를 모두 보존하고 있다는 것을 의미`한다.

이처럼 퍼시스턴트 세그먼트 트리(Persistent Segment Tree; PST)는 `세그먼트 트리의 갱신 과정을 모두 저장하고 있는 자료구조`이다.

<br>

## 1. 개념

세그먼트 트리에서 다음과 같이 4개의 노드에 갱신이 발생한다고 하자.

![image](https://github.com/siwon-park/Algorithm-DataStructure/assets/93081720/09bdb6fd-8a65-45be-82db-4175fbbcad26)

그런데, 만약 누군가가 갑자기 "갱신되기 이전의 세그먼트 트리의 구간 값도 알려줘"라고 한다면 어떻게 할 것인가?

세그먼트 트리를 2개 만들면 될까? 만약 이러한 질문이 특정 시점마다 들어온다면? 특정 시점마다 세그먼트 트리를 만들어 줘야할까?

만약 그렇게 된다면 엄청나게 많은 메모리가 필요할 것이다.

당장 우리가 보편적으로 세그먼트 트리를 선언할 때 노드 수가 N개 있다고 하면 N * 4로 통상 4배의 크기로 설정하는데, 그 수가 많아진다면 엄청나게 많은 메모리를 사용하게 될 것이다.

PST는 그렇게 세그먼트 트리를 새롭게 다시 만들지 말고, 값이 바뀌는 `O(logN)`개의 정점만 새로 만들어 주는 것이 핵심 개념이다.

![image](https://github.com/siwon-park/Algorithm-DataStructure/assets/93081720/fb1a33b6-7929-49b8-afd2-f6ce09355f6f)

이렇게 하면 기존의 정점을 재활용할 수 있고, 새롭게 업데이트 된 내용은 바뀐대로 반영이 가능해진다.

이 상태에서 또 추가적으로 업데이트가 발생한다면?

| 추가 업데이트 발생                                           | 업데이트 되는 곳만 새로 생성                                 |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image](https://github.com/siwon-park/Algorithm-DataStructure/assets/93081720/a4fdb5e7-434d-44d6-ab8f-3eafde57ab47) | ![image](https://github.com/siwon-park/Algorithm-DataStructure/assets/93081720/4a46df99-ae99-4c6b-8fa6-db9367abd840) |

마찬가지로 업데이트 되는 `O(logN)`개의 노드에 대해서만 새롭게 생성해주면 된다.

초기에 N개의 정점을 생성하고 각 쿼리마다 O(logN)개의 정점을 추가 생성하므로 총 공간 복잡도는 `O(N + QlogN)`이다.

과거의 노드를 재활용해야 하기 때문에 구조체나 클래스 자료형을 선언해서 트리를 구성하고 포인터 혹은 참조하여 서로 연결시켜주는 방식을 통해서 구현하면 된다.

