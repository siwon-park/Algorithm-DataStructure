# 기하학

기하학 관련 수식이나 알고리즘 내용 정리

<br>

# 1. CCW(Counter Clock Wise)

CCW은 3개의 점 `A(x1, y1)`, `B(x2, y2)`, `C(x3, y3)`가 있을 때, 이 점 3개를 이은 직선의 뱡향성을 알고자 할 때 사용하는 기하학 알고리즘이다.

글자 그대로 `반시계`라는 의미를 담고 있다.

### 공식

2차원의 평면을 기준이다. 애초에 2차원의 평면이니 z축의 값이 0이라서 아래와 같이 계산할 수 있는 것이다.

![image](https://user-images.githubusercontent.com/93081720/178147244-bfe5df44-1feb-4d9c-8f01-3872a205d999.png)

### 방향성 판별

계산 결과에 따른 방향성은 다음과 같이 판별할 수 있다.

시계, 반시계 방향을 판별하는 것은 아래 그림에서 1번에서 출발해서 3번까지 가는 방향성을 말한다.

| 반시계 (CCW > 0)                                             | 시계 (CCW < 0)                                               | 평행 (CCW = 0)                                               |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image](https://user-images.githubusercontent.com/93081720/178146917-39f02452-8020-4cf7-bbcb-a33cc9759c5b.png) | ![image](https://user-images.githubusercontent.com/93081720/178146930-1241b7ce-c64a-4a5e-8938-a733d9c487c5.png) | ![image](https://user-images.githubusercontent.com/93081720/178146935-77941c42-03a2-413c-a964-e4bf3e6924aa.png) |

<br>

## 2. 선분 교차 판별

선분의 교차를 판별함에 있어 CCW를 사용할 수 있다.

### 기초

| 선분                                                         | 벡터                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image](https://github.com/siwon-park/Problem_Solving/assets/93081720/d6355f4d-a196-463f-ac25-681952010f86) | ![image](https://github.com/siwon-park/Problem_Solving/assets/93081720/b6e8551f-1c4c-4fbe-ac8d-57389e9e0839) |

위와 같은 선분이 2개 있다고 할 때, `P1 → P2`방향의 벡터를 `v1`, `P1 → P3`방향의 벡터를 `v2`, `P1 → P4`방향의 벡터를 `v3`라고 하자. (지금 예시에서는 어느 점을 기준으로 잡든 간에 교차하기 때문에 큰 상관 없다)

- `v1 → v2`로의 회전 방향(`P2 → P1 → P3`)은 시계 방향 회전이기 때문에 CCW 결과는 `양수`이다.
- `v1 → v3`로의 회전 방향(`P2 → P1 → P4`)은 반시계 방향 회전이기 때문에 CCW 결과는 `음수`이다.

따라서 우리는 `기본적으로` **두 벡터 쌍(CCW 결과)의 곱이 음수이면 선분이 교차한다**고 일차적으로 결론 낼 수 있다.

<br>

### 심화

#### 예외 케이스 1

그러나 다음과 같은 예시에서는 두 벡터쌍의 곱이 음수임에도 불구하고 선분이 교차한다고 할 수 없다.

| 선분                                                         | 벡터1                                                        | 벡터2                                                        |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image](https://github.com/siwon-park/Problem_Solving/assets/93081720/475ae14b-6d9a-46ea-8dda-6b71c6b2f2b9) | ![image](https://github.com/siwon-park/Problem_Solving/assets/93081720/b7e8d97c-9def-43fc-9a0d-616784a5ed8d) | ![image](https://github.com/siwon-park/Problem_Solving/assets/93081720/ea5a9450-f17f-4c53-864d-90ee44300014) |

[벡터1]의 그림을 보면 두 CCW의 곱이 음수이지만 사실 두 선분은 떨어져 있기 때문에 교차하는 것이 아니다.

그러나 `P3 → P4`를 기준 벡터로 잡고 `v4 → v5`, `v4 → v6` 두 벡터 쌍의 곱을 구하면 둘 다 반시계 방향으로 방향성이 같기 때문에 연산 결과 `양수`가 나온다.

따라서 우리는 두 벡터 쌍의 곱이 음수라고 해서 선분이 교차한다고 결론을 내리는 것이 아니라,

**선분1을 기준으로 한 두 벡터 쌍의 곱이 음수이면서, 선분2를 기준으로 한 두 벡터 쌍의 곱이 음수이면 선분이 교차한다**고 잠정적으로 결론 지을 수 있다.

과연 그럴까? `세 개의 점이 일직선 상`에 있다면?

| 일직선 1                                                     | 일직선 2                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image](https://github.com/siwon-park/Problem_Solving/assets/93081720/93b4b682-349b-4428-b774-bb20b5e1ccbe) | ![image](https://github.com/siwon-park/Problem_Solving/assets/93081720/9b456862-b50f-4c7d-992c-16d373e8f34a) |

세 개의 점이 일직선 상에 있다면 `어느 한 선분의 벡터 쌍의 곱 결과`는 `0`이 나올 것이다.

따라서 `ccw(p1, p2, p3) * ccw(p1, p2, p4) <= 0` AND `ccw(p3, p4, p1) * ccw(p3, p4, p2) <= 0`일 때 교차한다고 볼 수 있다

#### 예외 케이스 2

그런데 만약 두 선분 모두 동일 선상에 위치하여 벡터 쌍의 곱 둘 다 0이라면 어떻게 판별할까?

다음과 같이 교차하지 않는 경우와 교차하는 경우가 있는데 어떻게 판별해야 할까?

| 일직선 (교차 X)                                              | 일직선 (교차 O)                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image](https://github.com/siwon-park/Problem_Solving/assets/93081720/7f4e6ba6-a613-4acd-b84f-1d467a222ee6) | ![image](https://github.com/siwon-park/Problem_Solving/assets/93081720/6e70b422-ac2c-42de-bbfc-5a3a8f16c6dd) |

이렇게 모든 벡터 쌍의 곱이 0일 경우에는 결국 두 선분 모두 일직선 상에 있다는 의미인데

이 때는 결국 일직선 상에 있으므로 `점들의 위치에 따라 교차 여부를 판별`할 수 있다!

겹치는 관계를 갖기 위해서는 `P2 > P3`이면서, `P4 > P1`이어야 한다. 일직선 상에 있으니 점들 간 위치에 따른 대소 비교가 가능해진다.

- 두 점 Pa, Pb가 있다고 할 때
  - Pa의 x값이 Pb의 x값 보다 크다 => Pa.x > Pb.x이면 `Pa > Pb`이다.
  - Pb의 x값이 Pa의 x값 보다 크다 => Pa.x < Pb.x이면 `Pa < Pb`이다.
  - 만약 두 점의 x값이 같다면
    - Pa의 y값이 Pb의 y값 보다 크다 => Pa.y > Pb.y이면 `Pa > Pb`이다.
    - Pb의 y값이 Pa의 y값 보다 크다 => Pa.y < Pb.y이면 `Pa < Pb`이다.

즉, `P2 > P3` AND `P4 > P1`일 때 두 직선이 교차한다.

### 결론

위의 내용을 종합적으로 정리하여 두 선분의 교차 여부를 판별에 대한 결론을 내면

- 두 선분이 일직선 상에 있을 때
  - `P2 > P3` AND `P4 > P1`
  - 단, 최종 대소 비교 전에 `P1 < P2`와 `P3 < P4`를 만족시킨 상태에서 진행해야 하므로 PS를 할 때, P1과 P2 간 혹은 P3와 P4 간 스왑(swap)이 필요할 수도 있다.
- 두 선분이 일직선 상에 있지 않거나 어느 한쪽만 일직선 상일 때
  - `ccw(p1, p2, p3) * ccw(p1, p2, p4) <= 0` AND `ccw(p3, p4, p1) * ccw(p3, p4, p2) <= 0`

